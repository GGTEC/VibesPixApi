<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel do Streamer · VibesPix</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" crossorigin>
</head>
<body>
  <div id="toast-container" class="toast-container"></div>
  <button id="mobile-toggle" class="mobile-toggle hidden">Menu</button>
  <div id="login-layer" class="login-layer">
    <div class="glass-card">
      <h2 class="title">Painel do Streamer</h2>
      <p class="subtitle">Faça login com usuário ou e-mail para acessar todas as abas.</p>
      <input id="login-identifier" type="text" placeholder="nome_usuario ou email" class="input" autocomplete="username">
      <input id="login-password" type="password" placeholder="Senha" class="input" autocomplete="current-password">
      <button id="login-btn" class="btn-primary">Entrar</button>
      <div id="login-erro" class="toast error hidden">Credenciais inválidas</div>
    </div>
  </div>

  <div class="layout hidden" id="app">
    <aside class="sidebar">
      <div class="brand">Painel</div>
      <div class="nav-group">
        <button class="nav-btn active" data-main="config">Configuração</button>
        <div class="subnav" id="config-subnav">
          <button class="sub-btn active" data-tab="tab-rcon">RCON</button>
          <button class="sub-btn" data-tab="tab-checkout">Checkout</button>
          <button class="sub-btn" data-tab="tab-sound">Áudio</button>
          <button class="sub-btn" data-tab="tab-overlay">Overlay</button>
          <button class="sub-btn" data-tab="tab-storeconfig">Loja</button>
        </div>
        <button class="nav-btn" data-main="store">Loja / Produtos</button>
        <button class="nav-btn" data-main="purchases">Registro de compras</button>
        <button id="store-link-btn" class="nav-btn" type="button">Abrir loja pública →</button>
        <button id="logout-btn" class="nav-btn" style="margin-top:6px;">Sair</button>
      </div>
    </aside>
    <main class="content">
      <div class="panel">
        <div id="config-section" class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
            <div>
              <h2 style="margin:0 0 6px;">Configuração</h2>
              <p class="subtitle" style="text-align:left;margin:0;">RCON, checkout, áudio e overlay agrupados nesta aba.</p>
            </div>
          </div>

          <div id="tab-rcon" class="tab-content">
            <div class="section">
              <h3>Configuração RCON <span class="pill">Minecraft</span></h3>
              <div class="form-grid">
                <input id="host" placeholder="IP do servidor" class="input" autocomplete="off">
                <input id="port" placeholder="Porta" class="input" autocomplete="off">
                <input id="password" placeholder="Senha" type="password" class="input" autocomplete="off">
              </div>
            </div>
          </div>

          <div id="tab-checkout" class="tab-content hidden">
            <div class="section">
              <h3>Checkout InfinityPay <span class="pill">handle</span></h3>
              <div class="form-grid">
                <input id="infinitypay-handle" placeholder="Nome/handle do checkout" class="input" autocomplete="off">
              </div>
              <p class="help-text">Use este nome para montar o link de checkout no InfinityPay.</p>
            </div>
          </div>

          <div id="tab-sound" class="tab-content hidden">
            <div class="section">
              <h3>Áudio de alerta <span class="pill">sound</span></h3>
              <div class="select-wrapper" >
                <select id="sound" class="input" style="background: rgba(255,255,255,0.08);">
                  <option value="" disabled>Selecione um áudio</option>
                </select>
              </div>
              <div class="file-input" id="sound-upload-box" style="margin-top:12px;">
                <span class="file-label">Enviar MP3</span>
                <span class="file-name" id="sound-file-name">Selecione um arquivo</span>
                <input id="sound-upload" type="file" accept="audio/*">
              </div>
              <p class="help-text">Envie um áudio (até 8MB). Ele fica disponível em /:user/sounds/ e aparece na lista acima.</p>
            </div>
          </div>

          <div id="tab-overlay" class="tab-content hidden">
            <div class="section">
              <h3>Overlay <span class="pill">mensagem padrão</span></h3>
              <p class="help-text">Texto exibido no topo do alerta. use {username} para o nome do comprador e {valor} para o valor da compra.</p>
              <input id="overlay-message" placeholder="Ex: NOVA COMPRA" class="input" autocomplete="off">

              <div class="form-grid" style="margin-top:12px;">
                <div style="grid-column:1 / -1;">
                  <label class="label">Link da overlay (copie para usar no OBS)</label>
                  <div class="row" style="grid-template-columns: 1fr auto; align-items: center; gap: 10px;">
                    <input id="overlay-link" class="input" readonly>
                    <button id="copy-overlay-link" class="btn-secondary" type="button">Copiar</button>
                  </div>
                </div>
              </div>

              <div class="section" style="margin-top:14px; background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.08);">
                <h3>Meta de arrecadação <span class="pill">goal overlay</span></h3>
                <p class="help-text">Configure a barra de meta exibida em /:user/goal. Use {current}, {target} ou {remaining} para personalizar o texto.</p>
                <div class="form-grid">
                  <div>
                    <label class="label">Valor da meta (R$)</label>
                    <input id="goal-target" type="number" step="0.01" min="0" class="input" placeholder="100.00">
                  </div>
                  <div>
                    <label class="label">Valor recebido</label>
                    <input id="goal-current" type="number" step="0.01" min="0" class="input" placeholder="0.00">
                  </div>
                  <div>
                    <label class="label">Texto da meta</label>
                    <input id="goal-text-template" class="input" placeholder="Meta: {current} / {target}">
                  </div>
                  <div>
                    <label class="label">Posição do texto</label>
                    <select id="goal-text-position" class="input">
                      <option value="inside">Dentro da barra</option>
                      <option value="above">Acima da barra</option>
                    </select>
                  </div>
                  <div>
                    <label class="label">Símbolo de moeda</label>
                    <label style="display:flex;align-items:center;gap:8px;color:var(--text);font-weight:600;">
                      <input id="goal-show-currency" type="checkbox" checked style="width:18px;height:18px;" />
                      Mostrar "R$" nos valores
                    </label>
                    <p class="help-text">Desmarque para esconder o símbolo e deixar apenas o número.</p>
                  </div>
                  <div>
                    <label class="label">Cor do fundo da barra</label>
                    <div class="color-control">
                      <div id="goal-bar-bg-swatch" class="color-swatch"></div>
                      <input id="goal-bar-bg-text" class="input" placeholder="#0f172a" autocomplete="off">
                      <input id="goal-bar-bg-picker" type="color" style="display:none;">
                    </div>
                  </div>
                  <div>
                    <label class="label">Cor do progresso</label>
                    <div class="color-control">
                      <div id="goal-bar-fill-swatch" class="color-swatch"></div>
                      <input id="goal-bar-fill-text" class="input" placeholder="#22d3ee" autocomplete="off">
                      <input id="goal-bar-fill-picker" type="color" style="display:none;">
                    </div>
                  </div>
                  <div>
                    <label class="label">Cor do texto</label>
                    <div class="color-control">
                      <div id="goal-text-color-swatch" class="color-swatch"></div>
                      <input id="goal-text-color-text" class="input" placeholder="#e5e7eb" autocomplete="off">
                      <input id="goal-text-color-picker" type="color" style="display:none;">
                    </div>
                  </div>
                </div>

                <div class="form-grid" style="margin-top:12px;">
                  <div style="grid-column:1 / -1;">
                    <label class="label">Link do overlay de meta</label>
                    <div class="row" style="grid-template-columns: 1fr auto; align-items: center; gap: 10px;">
                      <input id="goal-overlay-link" class="input" readonly>
                      <button id="copy-goal-overlay-link" class="btn-secondary" type="button">Copiar</button>
                    </div>
                  </div>
                </div>
              </div>

              <h3 style="margin-top: 15px;">Voz do TTS</h3>
              <div class="select-wrapper">
                <select id="tts-voice" class="input" style="background: rgba(255,255,255,0.08);">
                  <option value="" disabled>Selecione a voz</option>
                </select>
              </div>

              <p class="help-text">Voz usada na síntese do TTS do alerta.</p>
              <button id="tts-test" class="btn-primary" style="margin-top:10px;width: 180px;padding: 10px 12px;">Testar voz</button>
            </div>
          </div>

          <div id="tab-storeconfig" class="tab-content hidden">
            <div class="section">
              <h3>Configuração da Loja <span class="pill">lead</span></h3>

              <label class="label" for="store-name">Título da loja</label>
              <input id="store-name" class="input" placeholder="Ex: Loja do GGTEC" />

              <label class="label" for="store-lead" style="margin-top:10px;">Lead da loja</label>
              <input id="store-lead" class="input" placeholder="Ex: Compre interações para a live!" />
              <p class="help-text">Exibido junto ao título nas páginas públicas /loja e /donate.</p>

              <label class="label" for="store-lead-bg" style="margin-top:12px;">Fundo do banner (título + lead)</label>
              <input id="store-lead-bg" class="input" placeholder="Escolha uma imagem" readonly style="cursor:pointer;" />
              <input id="store-lead-bg-url" type="hidden" />
              <p class="help-text">Usado no topo das páginas /loja e /donate, atrás do título e do lead.</p>

              <label class="label" for="store-bg" style="margin-top:12px;">Background geral das páginas</label>
              <input id="store-bg" class="input" placeholder="Escolha uma imagem" readonly style="cursor:pointer;" />
              <input id="store-bg-url" type="hidden" />
              <p class="help-text">Fundo principal aplicado em /loja e /donate.</p>
            </div>
          </div>

          <button id="btn-salvar-config" class="btn-primary hidden" style="margin-top:14px;">Salvar configurações</button>
        </div>

        <div id="store-section" class="card hidden">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
            <div>
              <h2 style="margin:0 0 6px;">Loja e Produtos</h2>
              <p class="subtitle" style="text-align:left;margin:0;">Gerencie produtos e mídias da sua loja.</p>
            </div>
          </div>
          <div id="store-tab-products" class="tab-content">
            <div class="section">
              <div class="row">
                <div>
                  <label class="label">Produto existente</label>
                  <select id="productSelect" class="input"></select>
                </div>
              </div>

              <div id="productFormSection" class="section hidden" style="margin-top:12px;background: transparent;padding: 0;border: 0;">
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
                  <div>
                    <label class="label">ID do produto</label>
                    <input id="newProductId" class="input" placeholder="ex: vip_gold" />
                  </div>
                  <div>
                    <label class="label">Título</label>
                    <input id="productTitle" class="input" placeholder="ex: VIP Gold" />
                  </div>
                  <div>
                    <label class="label">Valor em R$ (exibição)</label>
                    <input id="productPrice" type="number" step="0.01" class="input" placeholder="ex: 5.50" />
                  </div>
                  <div>
                    <label class="label">Quantidade</label>
                    <input id="productQty" type="number" class="input" placeholder="ex: 1" />
                  </div>
                  <div style="grid-column:1 / -1;">
                    <label class="label">Comandos (um por linha; use {player} / {username})</label>
                    <textarea id="productCmds" class="input" spellcheck="false" placeholder="give {player} diamond 1"></textarea>
                  </div>
                  <div style="grid-column:1 / -1;">
                    <label class="label">Imagem (URL)</label>
                    <input id="productImg" class="input" placeholder="Escolha uma imagem" readonly style="cursor:pointer;" />
                    <input id="productImgUrl" type="hidden" />
                    <small style="color: var(--muted);">Clique para escolher ou enviar uma imagem</small>
                  </div>
                </div>

                <div class="actions" style="gap:10px;">
                  <button class="btn-secondary" id="btnTestProduct" style="width:auto;padding:12px 14px;">Testar produto (RCON + overlay)</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="purchases-section" class="card hidden" style="display:flex;flex-direction:column;gap:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
            <div>
              <h2 style="margin:0 0 6px;">Registro de compras</h2>
              <p class="subtitle" style="text-align:left;margin:0;">Histórico e replay dos pedidos.</p>
            </div>
            <button id="refreshPurchases" class="btn-secondary" type="button" style="width:auto;padding:10px 12px;">Atualizar</button>
          </div>

          <div class="section" style="margin-top:0;">
            <h3>Métricas <span class="pill">período</span></h3>
            <form id="metricsForm" class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); align-items:end;">
              <div>
                <label class="label">De</label>
                <input id="metricsFrom" class="input" type="date" required />
              </div>
              <div>
                <label class="label">Até</label>
                <input id="metricsTo" class="input" type="date" required />
              </div>
              <div>
                <button id="metricsBtn" class="btn-secondary" type="submit" style="width:auto;">Calcular</button>
              </div>
            </form>
            <div class="metrics-grid">
              <canvas id="metricsChart" class="metrics-chart" width="900" height="220" hidden></canvas>
              <div id="metricsResult" class="metrics-summary" hidden></div>
              <div id="metricsPurchases" class="purchases-table" hidden></div>
            </div>
          </div>

          <div id="purchaseList" class="list" style="flex:1;min-height:0;overflow-y:auto;display:flex;flex-direction:column;gap:10px;"></div>
        </div>
      </div>
    </main>
  </div>

  <div id="action-bar-config" class="bottom-bar hidden">
    <button id="action-save-config" class="btn-primary" type="button">Salvar configurações</button>
  </div>
  <div id="action-bar-store" class="bottom-bar hidden">
    <button id="action-save-product" class="btn-primary" type="button">Salvar</button>
    <button id="action-delete-product" class="btn-danger" type="button">Remover</button>
    <button id="action-clear-product" class="btn-secondary" type="button">Limpar</button>
  </div>

  <div id="imageModal" class="modal-backdrop" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Imagens do usuário</h3>
        <button class="modal-close" id="modalClose">×</button>
      </div>
      <div class="modal-upload">
        <label class="label">Enviar nova imagem</label>
        <div class="file-input">
          <span class="file-name" id="modalFileName">Nenhum arquivo</span>
          <input type="file" id="modalFileInput" accept="image/*" />
        </div>
      </div>
      <div>
        <label class="label">Galeria</label>
        <div id="imageGallery" class="image-gallery"></div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>

</body>
</html>
